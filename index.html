<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Конфигуратор Авто</title>
    
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>

    <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        
        /* Стиль 3D окна */
        model-viewer {
            width: 100vw;
            height: 100vh;
            background: radial-gradient(#ffffff, #c5c5c5);
        }

        /* Панель управления */
        .ui-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 10;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            background: #4CAF50;
            color: white;
            border-radius: 5px;
            font-size: 12px;
            margin-top: 10px;
        }

        button {
            margin-top: 10px;
            padding: 8px 15px;
            border: none;
            background: #007bff;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }
        
        button:hover { background: #0056b3; }

        /* Стиль для меток (Hotspots) */
        .hotspot {
            background: #fff;
            border-radius: 50%;
            border: 2px solid #007bff;
            width: 15px;
            height: 15px;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="ui-panel">
        <h2>Управление авто</h2>
        <div id="part-name">Нажмите на деталь</div>
        <div id="status" class="status-badge">Статус: Ожидание</div>
        <br>
        <button onclick="setRandomColor()">Случайный цвет детали</button>
    </div>

    <model-viewer 
        id="car" 
        src="car.glb" 
        camera-controls 
        auto-rotate 
        shadow-intensity="2" 
        exposure="1"
        ar>
        
        <button class="hotspot" slot="hotspot-check" data-position="0m 1m 0m" data-normal="0m 1m 0m"></button>

    </model-viewer>

    <script>
        const modelViewer = document.querySelector("#car");
        const partDisplay = document.querySelector("#part-name");
        const statusDisplay = document.querySelector("#status");
        let selectedMaterial = null;

        // 1. Обработка клика по машине
        modelViewer.addEventListener('click', (event) => {
            const material = modelViewer.materialFromPoint(event.clientX, event.clientY);
            
            if (material) {
                selectedMaterial = material;
                partDisplay.innerHTML = "<b>Выбрано:</b> " + material.name;
                statusDisplay.innerText = "Статус: Деталь активна";
                statusDisplay.style.background = "#007bff";
            }
        });

        // 2. Функция смены цвета выбранной детали
        function setRandomColor() {
            if (selectedMaterial) {
                // Генерируем случайный цвет в формате [R, G, B, A]
                const color = [Math.random(), Math.random(), Math.random(), 1];
                selectedMaterial.pbrMetallicRoughness.setBaseColorFactor(color);
                statusDisplay.innerText = "Статус: Цвет изменен";
                statusDisplay.style.background = "#ff9800";
            } else {
                alert("Сначала кликните на любую часть машины!");
            }
        }
    </script>
</body>
</html>
